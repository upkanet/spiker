<html>

<head>
    <title>Axorus - Spiker</title>
</head>
<style>
    body {
        background-color: black;
    }
</style>
<script src="js/jquery3.5.1.min.js"></script>
<script src="js/plotly-latest.min.js"></script>
<script>
    var layoutBlack = { paper_bgcolor: 'black', plot_bgcolor: 'black', font: { color: 'white' }, xaxis: {'title': '', ticksuffix:'', spikemode: 'toaxis'}, yaxis: {spikemode: 'toaxis'}, hovermode: 'closest' };
    
    function loadRecords(){
        $.getJSON('/records', function (rs) {
            rs.forEach(r => {
                $('#records').append(`<button onclick="loadRecord(this);">${r}</button>`);
            });
        });
    }

    function loadRecord(btn){
        var r = $(btn).html();
        $.getJSON('/electrodes', (el) => {
            $('#electrodes').append(`<button onclick="loadElectrode('${r}',this);">${el}</button>`);
        });
    }

    function loadElectrode(r,btn){
        var el = $(btn).html();
        console.log(r,el);
        load(r,el);
    }

    function load(record,electrode){
        $.getJSON(`/${record}/${electrode}`, function (el) {
            console.log(el);
            var data = el.data
            var sample_rate = el.sample_rate;
            var d = {x: data.map((x,index) => index / sample_rate), y: data.map(x => x), type: 'line' };
            layoutBlack.xaxis.title = 'time';
            layoutBlack.xaxis.ticksuffix = 's';
            Plotly.newPlot('gElectrode', [d], layoutBlack);
            
            var spectrum_data = el.spectrum_data;
            var N = spectrum_data.length;
            var ds = {x: spectrum_data.map((x,k) => k / (2 * N / sample_rate)), y: spectrum_data.map(x => x), type: 'line' };
            layoutBlack.xaxis.title = 'frequency';
            layoutBlack.xaxis.ticksuffix = 'Hz';
            Plotly.newPlot('gSpectrum', [ds], layoutBlack);
        });
    }

    loadRecords();

</script>

<body>
    <div id="records"></div>
    <div id="electrodes"></div>
    <div id="gElectrode" style="width:100%;height:45%;"></div>
    <div id="gSpectrum" style="width:100%;height:45%;"></div>
</body>

</html>